<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/data.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<script src="https://code.highcharts.com/stock/modules/export-data.js"></script>


<div id="container" style="height: 400px; min-width: 310px"></div>
<script>
var seriesOptions = [],
  seriesCounter = 0,
  names = ['datchik_5'],
  last_id_5;
/**
 * Create the chart when all data is loaded
 * @returns {undefined}
 */
function createChart() {
  Highcharts.stockChart('container', {


    rangeSelector: {
			buttons: [{
					count: 60,
					type: 'minute',
					text: '1ч'
				}, {
					count: 320,
					type: 'minute',
					text: '6ч'
				},
				{
					count: 720,
					type: 'minute',
					text: '12ч'
				},
				{
					count: 1440,
					type: 'minute',
					text: '24ч'
				},
				{
					count: 3,
					type: 'day',
					text: '3д'
				},
				{
					count: 7,
					type: 'day',
					text: '7д'
				},
				{
					count: 14,
					type: 'day',
					text: '14д'
				},
				{
					count: 30,
					type: 'day',
					text: '30д'
				},
				{
					type: 'all',
					text: 'Всё'
				}
			],
			inputEnabled: false,
			selected: 5,

			buttonSpacing: 30,
			buttonTheme: { // styles for the buttons
				width: 45,
				style: {
					color: '#000000',
				},
				states: {
					hover: {
						fill: '#42A5F5',
						style: {
							color: 'white'
						}
					},
					select: {
						fill: '#29B6F6',
						style: {
							color: 'white'
						}
					}
				}
			},
		},

    yAxis: {
      // labels: {
      //   formatter: function () {
      //     return (this.value > 0 ? ' + ' : '') + this.value + '%';
      //   }
      // },
      plotLines: [{
        value: 0,
        width: 2,
        color: 'silver'
      }]
    },

    // plotOptions: {
    //   series: {
    //     compare: 'percent',
    //     showInNavigator: true
    //   }
    // },

    // tooltip: {
    //   pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
    //   valueDecimals: 2,
    //   split: true
    // },

    series: seriesOptions
});
}

function success(data_server) {
	console.log(data_server)
  var name = data_server['name'];
  var i = 0;
  seriesOptions[i] = {
    name: name,
    data: function () {
      // generate an array of random data
      var data = [],
        time = data_server['time'],
        dat = data_server['data'],
        n;
		console.log(time)
      for (n = 0; n <= time.length - 1; n += 1) {
        data.push([
          time[n],
          dat[n]
        ]);
      }
      last_id_5 = data_server['length'];
      return data;
    }()
  };

  // As we're loading the data asynchronously, we don't know what order it
  // will arrive. So we keep a counter and create the chart when all the data is loaded.
  seriesCounter += 1;

  if (seriesCounter === names.length) {
    createChart();
  }
}

Highcharts.getJSON(
  '/get_data_5',
  success
);
</script>